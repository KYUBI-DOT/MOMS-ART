{{> header}}

<style>
  body {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    background-color: #f6f6f6;
    color: #1c1c1c;
    margin: 0;
    padding: 0;
  }

  .cart-wrapper {
    margin-top: 120px;
    display: flex;
    justify-content: center;
    gap: 32px;
    padding: 60px 20px;
    flex-wrap: wrap;
  }

  .cart-left, .cart-right {
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.05);
    padding: 32px;
  }

  .cart-left {
    flex: 2;
    min-width: 600px;
  }

  .cart-right {
    flex: 1;
    min-width: 280px;
    max-width: 360px;
  }

  .cart-left h4,
  .cart-right h4 {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 24px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  th, td {
    padding: 12px 8px;
    border-bottom: 1px solid #eee;
    vertical-align: middle;
  }

  .quantity-buttons {
    display: flex;
    border: 1px solid #ccc;
    border-radius: 4px;
    overflow: hidden;
    width: 100px;
  }

  .quantity-buttons button {
    background-color: #f8f8f8;
    border: none;
    padding: 6px 12px;
    flex: 1;
    cursor: pointer;
  }

  .quantity-input {
    width: 40px;
    text-align: center;
    border: none;
    background-color: white;
    font-weight: bold;
  }

  .btn-danger {
    background-color: transparent;
    border: 1px solid #dc3545;
    color: #dc3545;
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 500;
  }

  .btn-danger:hover {
    background-color: #dc3545;
    color: white;
  }

  .summary-line {
    display: flex;
    justify-content: space-between;
    margin: 10px 0;
  }

  .summary-line.total {
    font-weight: 600;
    font-size: 16px;
    border-top: 1px solid #ddd;
    padding-top: 10px;
  }

  .checkout-button {
    display: block;
    width: 100%;
    background-color: #000;
    color: white;
    padding: 14px;
    border: none;
    border-radius: 6px;
    margin-top: 24px;
    font-size: 16px;
    cursor: pointer;
    transition: 0.3s;
  }

  .checkout-button:hover {
    background-color: #333;
  }

  .express-checkout {
    background-color: #006341;
    margin-top: 12px;
  }

  .note {
    font-size: 12px;
    color: #666;
    margin-top: 16px;
  }
</style>

<div class="cart-wrapper">

  <!-- âœ… Cart Items -->
  <div class="cart-left">
    <h4>Shopping Cart ({{totalItems}} item{{#if (gt totalItems 1)}}s{{/if}})</h4>
    <a href="/shop" style="text-decoration: underline; font-size: 14px;">Continue Shopping</a>

    {{#if itemAdded}}
      <div style="background-color: #d1e7dd; color: #0f5132; padding: 12px; border-radius: 6px; margin: 20px 0;">
        âœ… Item added to cart successfully!
      </div>
    {{/if}}

    {{#if cart.length}}
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Total</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {{#each cart}}
        <tr>
          <td>
            <img src="{{image}}" alt="{{product_name}}" style="width: 60px; border-radius: 6px;"><br>
            {{product_name}}
          </td>
          <td>
            <form action="/update_quantity" method="POST">
              <input type="hidden" name="product_id" value="{{product_id}}">
              <div class="quantity-buttons">
                <button type="submit" name="action" value="decrement">-</button>
                <input type="number" class="quantity-input" value="{{quantity}}" readonly>
                <button type="submit" name="action" value="increment">+</button>
              </div>
            </form>
          </td>
          <td>Nu {{product_price}}</td>
          <td>Nu {{multiply product_price quantity}}</td>
          <td>
            <form action="/cart/remove/{{product_id}}" method="POST" onsubmit="return confirm('Are you sure?')">
              <button class="btn-danger">Remove</button>
            </form>
          </td>
        </tr>
        {{/each}}
      </tbody>
    </table>
    {{else}}
      <p style="margin-top: 20px;">ðŸ›’ Your cart is empty.</p>
    {{/if}}
  </div>

  <!-- âœ… Summary Panel -->
  <div class="cart-right">
    <h4>Summary</h4>

    {{#if (lt totalPrice 150)}}
      <div class="note">You are Nu {{subtract 150 totalPrice}} away from free shipping</div>
    {{else}}
      <div class="note">ðŸŽ‰ You have qualified for free shipping!</div>
    {{/if}}

    <div class="summary-line">
      <span>Subtotal</span>
      <span>Nu {{totalPrice}}</span>
    </div>
    <div class="summary-line">
      <span>Shipping</span>
      <span>{{#if (lt totalPrice 150)}}Nu 10.00{{else}}Free{{/if}}</span>
    </div>
    <div class="summary-line">
      <span>GST included</span>
      <span>Nu {{multiply totalPrice 0.1}}</span>
    </div>
    <div class="summary-line total">
      <span>Total</span>
      <span>
        Nu {{#if (lt totalPrice 150)}}{{add totalPrice 10}}{{else}}{{totalPrice}}{{/if}}
      </span>
    </div>

    <button class="checkout-button">Checkout</button>
    <button class="checkout-button express-checkout">Express Checkout</button>

    <div class="summary-line" style="margin-top: 20px;">
      <span>Afterpay</span>
      <span>4 x Nu {{afterpayAmount (calculateFinalTotal totalPrice)}}</span>
    </div>

    <div class="note">
      E-Gift Cards: Redeem on the Payment page.
    </div>

    <div class="note">
      Delivery: Free shipping over Nu 150. Express Shipping available.
    </div>

    <div class="note">
      Returns: Enjoy a 60-day return policy. <a href="/returns" style="text-decoration: underline;">See full policy</a>.
    </div>
  </div>
</div>

{{> footer}}
