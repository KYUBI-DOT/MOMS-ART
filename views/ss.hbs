{{> header}}

<section style="text-align: center; padding: 60px;">
  <h1>üéâ Payment Successful!</h1>
  <p>Thank you for your purchase. Your order is being processed.</p>
  <a href="/shop"><button>Continue Shopping</button></a>
</section>

{{> footer}}

  <--
  const cartContainer = document.getElementById('cart-container');
  const totalAmountEl = document.getElementById('total-amount');
  let cart = JSON.parse(localStorage.getItem('cart')) || [];

  function renderCart() {
    cartContainer.innerHTML = '';
    let total = 0;

    if (cart.length === 0) {
      cartContainer.innerHTML = '<p style="text-align:center;">Your cart is empty.</p>';
      totalAmountEl.textContent = '0';
      return;
    }

    cart.forEach((item, index) => {
      const itemTotal = item.price * item.quantity;
      total += itemTotal;

      const itemDiv = document.createElement('div');
      itemDiv.style = "display: flex; gap: 20px; background: #fff; border-radius: 10px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);";
      itemDiv.innerHTML = `
        <img src="${item.image}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px;">
        <div style="flex: 1;">
          <h4>${item.name}</h4>
          <p>Price: Nu ${item.price}</p>
          <p>Quantity: <input type="number" min="1" value="${item.quantity}" onchange="updateQuantity(${index}, this.value)" style="width: 60px;"></p>
        </div>
        <div>
          <p><strong>Nu ${itemTotal}</strong></p>
          <button onclick="removeItem(${index})" style="background: crimson; color: white; border: none; padding: 5px 10px; border-radius: 5px;">Remove</button>
        </div>
      `;
      cartContainer.appendChild(itemDiv);
    });

    totalAmountEl.textContent = total.toFixed(2);
  }

  function updateQuantity(index, quantity) {
    cart[index].quantity = parseInt(quantity);
    localStorage.setItem('cart', JSON.stringify(cart));
    renderCart();
  }

  function removeItem(index) {
    cart.splice(index, 1);
    localStorage.setItem('cart', JSON.stringify(cart));
    renderCart();
  }

  async function checkout() {
    const response = await fetch('/payment/create-checkout-session', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ cartItems: cart })
    });

    const data = await response.json();
    if (data.url) {
      window.location.href = data.url;
    } else {
      alert("‚ùå Payment failed to initiate.");
    }
  }

  document.getElementById('checkout-button').addEventListener('click', checkout);

  renderCart();
</script>
